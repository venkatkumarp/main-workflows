name: "Path-Based Trigger Workflow"

on:
  pull_request:
    branches:
      - main
    types:
      - opened
      - synchronize
    paths:
      - "frontend/*"
      - "backend/*"

env:
  paths: 'frontend/, backend/'

jobs:
  output_path:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: git config
        run: git config --global --add safe.directory '*'

      - name: Get changed files
        id: changes
        run: |
          echo "files=$(git diff --name-only --diff-filter=ACMRT ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | xargs)" >> $GITHUB_OUTPUT

      - name: Determine triggering path
        id: determine_path
        run: |
          # Show paths
          echo "Paths: ${{ env.paths }}"

          # Get the list of paths being monitored
          monitored_paths=$(echo "${{ env.paths }}" | tr "," " ")
          echo "Monitored paths: $monitored_paths"
          echo "Changed files: ${{ steps.changes.outputs.files }}"
          echo "If you see here files that you have not modified, please update your branch with changes from main."

          # Loop through each path
          for path in $monitored_paths
          do
            # Check if the modified files include this path
            if echo "${{ steps.changes.outputs.files }}" | grep -q "$path"; then
              # Set the output variable and exit the loop
              echo "triggering_path is $path"
              echo "triggering_path=$path" >> $GITHUB_OUTPUT
              break
            fi
          done
